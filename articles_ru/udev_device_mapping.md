 Udev Device Mapping
HDD
Конечно же это далеко не новость, но тем не менее. В общем возникло желание замапить свой жесткий диск который стоит в домашнем сервере. Так чтоб его можно было сколько угодно раз подключать отключать, а он в системе оставался под одним и тем же именем. Что для этого понадобится? А ничего, Linux, винт и текстовый редактор. В общем можно создать свой отдельный файл с правилом для udev, в который положим правила:

[root@amigo rules.d]# cd /etc/udev/rules.d
[root@amigo rules.d]# touch 30-local.rules

и добавляем туда что-то типа:

## Persistent name for removable USB hdd used for storage data
BUS=="usb", KERNEL=="sd?1", SYSFS{serial}=="124689F86033", NAME="%k", SYMLINK+="usbhdd1"

серийник можно узнать использовав команду:

[root@amigo rules.d]# udevinfo -a -p /sys/block/sda | grep serial
    SYSFS{serial}=="124689F86033"
    SYSFS{serial}=="0000:06:00.2"


далее в /etc/fstab добавляем привычную строчку монтирования диска. Имя у него теперь будет /dev/usbhdd1

/dev/usbhdd1 /var/media/    ext3    defaults,noatime,async  0 2

SCANNER
Если с винтом всё предельно ясно, то вот со сканером возник определённый ступор. Проблема со сканером была в том что доступ к нему мог иметь только root, меня это никак не устраивало, потому что сканировать я люблю из под своего юзера. И вот, чтоб каждый раз не ставить права на устройство руками, можно заюзать гибкое средство udev. На этот раз ничего создавать не пришлось, видимо когда поставился SANE, заодно и прописался файлик /etc/udev/rules.d/60-libsane.rules

# Mustek BearPaw 2448TA Pro 
SYSFS{idVendor}=="055f", SYSFS{idProduct}=="0409", SYMLINK+="scanner-%k"

В нём быстро был обнаружен мой сканер, и я тут же попытался добавить правила которые меня бы устроили GROUP:="scanner", MODE:="0660"
Но не тут то было! Правила автоматически не применялись. Сначала я долго не мог понять в чём подвох. Потом случайно обнаружил что, если убрать правило которое добавляет symlink, то всё хорошо. Ну, без symlink тоже всё прекрасно работает, не знаю в чем его назначение и почему так получается. В общем, правило стало выглядеть вот так:

SYSFS{idVendor}=="055f", SYSFS{idProduct}=="0409", GROUP:="scanner", MODE:="0660"

Добавил группу и включил в неё своего пользователя:

[root@amigo rules.d]# groupadd -r scanner
[root@amigo rules.d]# usermod -G scanner USERNAME

И всё заработало :)
